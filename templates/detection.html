{% extends "base.html" %}
{% block title %}Live Detection - SentinelDrive{% endblock %}
{% block content %}

<!-- Performance Stats -->
<div class="perf-stats">
    <div class="stat-item">
        <span class="stat-label">FPS</span>
        <span class="stat-value" id="fpsCounter">60</span>
    </div>
    <div class="stat-item">
        <span class="stat-label">Latency</span>
        <span class="stat-value" id="latencyCounter">0ms</span>
    </div>
    <div class="stat-item">
        <span class="stat-label">Memory</span>
        <span class="stat-value" id="memoryCounter">0MB</span>
    </div>
</div>

<!-- Alert Counter -->
<div class="alert-counter">
    <span>üö® Alerts: <span id="alertCount">0</span></span>
</div>

<div class="row g-4">
    <div class="col-lg-8">
        <div class="glass-card fade-in">
            <h2>üìπ LIVE DETECTION STREAM</h2>
            <canvas id="videoCanvas" width="800" height="600" class="mt-3 mb-3" style="width: 100%;"></canvas>
            <div class="alert alert-info" id="status" style="font-weight: 600;">
                ‚è≥ Ready to start detection. Configure your camera and click START.
            </div>
            <div class="d-grid gap-2 d-sm-flex">
                <button id="startBtn" class="btn btn-glass btn-lg">‚ñ∂ START DETECTION</button>
                <button id="stopBtn" class="btn btn-glass btn-lg" disabled>‚èπ STOP DETECTION</button>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <!-- METRICS DASHBOARD -->
        <div class="glass-card fade-in">
            <h4 style="text-align: center;">üìä REAL-TIME METRICS</h4>
            <div class="row g-3 mt-2">
                <div class="col-6">
                    <div class="metric-card">
                        <div class="metric-label">EAR</div>
                        <div class="metric-value" id="metricEAR">--</div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="metric-card">
                        <div class="metric-label">MAR</div>
                        <div class="metric-value" id="metricMAR">--</div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="metric-card">
                        <div class="metric-label">GAZE</div>
                        <div class="metric-value" id="metricGaze">--</div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="arc-progress">
                        <div class="arc-inner">
                            <div style="text-align: center;">
                                <div class="metric-label">FATIGUE</div>
                                <div class="metric-value" id="metricFatigue" style="font-size: 1.8rem;">0/10</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-3">
                <div class="metric-card">
                    <div class="metric-label">STATUS</div>
                    <div style="font-size: 1.3rem; font-weight: 700; color: #00ff88;" id="metricStatus">IDLE</div>
                </div>
            </div>
        </div>

        <!-- EXPORT BUTTON -->
        <button id="exportBtn" class="btn btn-glass btn-lg w-100 mt-3">üì• EXPORT SESSION</button>

        <!-- INSTRUCTIONS -->
        <div class="glass-card fade-in mt-3">
            <h5>‚ö° QUICK START</h5>
            <ol style="color: rgba(255, 255, 255, 0.95); font-size: 0.95rem;">
                <li>Click <strong>START DETECTION</strong></li>
                <li>Calibrate (5 sec) - look straight</li>
                <li>Live stream begins</li>
                <li>Real-time metrics update</li>
                <li>üîë Spacebar to start | ESC to stop</li>
            </ol>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/performance.js') }}"></script>
<script src="{{ url_for('static', filename='js/detection-ui.js') }}"></script>
{% endblock %}
